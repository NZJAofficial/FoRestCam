<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Toitumiskava</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f9f9f9;
  color: #111;
  margin: 0;
  padding: 0;
}
header {
  background: #4caf50;
  color: white;
  padding: 15px;
  text-align: center;
}
main {
  max-width: 600px;
  margin: 30px auto;
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
input, select, button {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1em;
}
button {
  background: #4caf50;
  color: white;
  border: none;
  cursor: pointer;
}
button:hover { background: #45a049; }
.hidden { display: none; }
h1, h2 { text-align: center; }

#recipeList { display: flex; flex-wrap: wrap; gap: 10px; }
.recipe {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  width: 45%;
  background: #fafafa;
}
.progress { width: 100%; background: #eee; border-radius: 10px; height: 20px; overflow: hidden; }
.progress div { height: 100%; background: linear-gradient(90deg,#4caf50,#8bc34a); width: 0%; transition: width .3s; }
table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
th { background: #f0f0f0; }
.admin-btn { background: #f44336; }
.admin-btn:hover { background: #d32f2f; }
</style>
</head>
<body>

<header><h1>Toitumiskava</h1></header>
<main>

<!-- Registreerimise leht -->
<section id="registerPage">
  <h2>Konto loomine</h2>
  <label>Eesnimi</label><input id="first">
  <label>Perekonnanimi</label><input id="last">
  <label>Vanus</label><input id="age" type="number">
  <label>Sugu</label>
  <select id="gender"><option value="M">Mees</option><option value="F">Naine</option></select>
  <label>Pikkus (cm)</label><input id="height" type="number">
  <label>Kaal (kg)</label><input id="weight" type="number">
  <label>Aktiivsus</label>
  <select id="activity">
    <option value="sedentary">Vähe aktiivne</option>
    <option value="moderate">Mõõdukas</option>
    <option value="active">Väga aktiivne</option>
  </select>
  <label>Eesmärk</label>
  <select id="goal">
    <option value="lose">Kaalu langetamine</option>
    <option value="maintain">Kaaluhooldus</option>
    <option value="gain">Kaalu tõstmine</option>
  </select>
  <button id="createAccount">Loo konto</button>
  <p id="registerInfo"></p>
  <p>Juba konto olemas? <a href="#" onclick="showPage('loginPage')">Logi sisse</a></p>
</section>

<!-- Sisselogimise leht -->
<section id="loginPage" class="hidden">
  <h2>Sisselogimine</h2>
  <p>Sisesta oma 10-kohaline kood või admini kood <b>admin123</b>.</p>
  <input id="loginCode" placeholder="Sisselogimiskood">
  <button id="loginBtn">Logi sisse</button>
  <p id="loginMsg"></p>
  <p><a href="#" onclick="showPage('registerPage')">Loo uus konto</a></p>
</section>

<!-- Retseptide leht -->
<section id="recipesPage" class="hidden">
  <h2>Retseptid ja progress</h2>
  <p id="userInfo"></p>
  <div id="recipeList"></div>
  <h3>Progress</h3>
  <input id="progressInput" type="range" min="0" max="100" value="0">
  <div class="progress"><div id="progressBar"></div></div>
  <button id="saveProgress">Salvesta progress</button>
  <button onclick="logout()">Logi välja</button>
</section>

<!-- Adminileht -->
<section id="adminPage" class="hidden">
  <h2>Adminpaneel</h2>
  <table>
    <thead><tr><th>Kood</th><th>Nimi</th><th>Vanus</th><th>Progress</th><th>Tegevus</th></tr></thead>
    <tbody id="adminTable"></tbody>
  </table>
  <button onclick="logout()">Logi välja</button>
</section>

</main>

<script>
// DEMO retseptid (võid asendada oma failist lugemisega)
const RECIPES = [
  {title:"Puder muna ja kodujuustuga", text:"Keeda puder, lisa muna ja kodujuust."},
  {title:"Omlett singiga", text:"Vahusta munad, lisa sink ja prae kuldseks."},
  {title:"Kanasalat", text:"Sega tükeldatud kana salatiga, maitsesta oliiviõliga."},
  {title:"Tatraroog köögiviljadega", text:"Keeda tatar ja sega hautatud köögiviljadega."},
];

function showPage(id) {
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// Lehe laadimisel
window.onload = ()=>{
  const logged = localStorage.getItem("logged");
  if(logged === "admin") showAdmin();
  else if(logged) showRecipes();
  else showPage("registerPage");
};

// Konto loomine
document.getElementById("createAccount").onclick = ()=>{
  const f = first.value.trim(), l = last.value.trim();
  if(!f || !l){ alert("Täida ees- ja perekonnanimi!"); return; }
  const data = {
    first:f, last:l, age:age.value, gender:gender.value,
    height:height.value, weight:weight.value,
    activity:activity.value, goal:goal.value, progress:0
  };
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  let code;
  do { code = Math.random().toString().slice(2,12); } while(users[code]);
  users[code] = data;
  localStorage.setItem("users",JSON.stringify(users));
  registerInfo.innerHTML = `Konto loodud!<br>Sinu sisselogimiskood: <b>${code}</b><br>
  <a href="#" onclick="showPage('loginPage')">Mine sisselogimisele</a>`;
};

// Sisselogimine
document.getElementById("loginBtn").onclick = ()=>{
  const code = loginCode.value.trim();
  const users = JSON.parse(localStorage.getItem("users")||"{}");
  if(code === "admin123"){
    localStorage.setItem("logged","admin");
    showAdmin();
    return;
  }
  if(users[code]){
    localStorage.setItem("logged",code);
    showRecipes();
  } else {
    loginMsg.textContent = "Vale kood!";
  }
};

// Retseptid + progress
function showRecipes(){
  showPage("recipesPage");
  const code = localStorage.getItem("logged");
  const users = JSON.parse(localStorage.getItem("users")||"{}");
  const u = users[code];
  if(!u){ showPage("loginPage"); return; }

  userInfo.textContent = `Tere, ${u.first} ${u.last}!`;

  // Näita retsepte
  const list = document.getElementById("recipeList");
  list.innerHTML = "";
  RECIPES.forEach(r=>{
    const div = document.createElement("div");
    div.className="recipe";
    div.innerHTML = `<h4>${r.title}</h4><p>${r.text}</p>`;
    list.appendChild(div);
  });

  // Progress
  progressInput.value = u.progress||0;
  document.getElementById("progressBar").style.width = (u.progress||0)+"%";

  progressInput.oninput = ()=> document.getElementById("progressBar").style.width = progressInput.value+"%";
  document.getElementById("saveProgress").onclick = ()=>{
    u.progress = progressInput.value;
    users[code]=u;
    localStorage.setItem("users",JSON.stringify(users));
    alert("Progress salvestatud!");
  };
}

// Adminpaneel
function showAdmin(){
  showPage("adminPage");
  const body = document.getElementById("adminTable");
  const users = JSON.parse(localStorage.getItem("users")||"{}");
  body.innerHTML="";
  for(const [code,u] of Object.entries(users)){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${code}</td><td>${u.first} ${u.last}</td><td>${u.age}</td>
                  <td>${u.progress||0}%</td>
                  <td><button class="admin-btn" onclick="delUser('${code}')">Kustuta</button></td>`;
    body.appendChild(tr);
  }
}
function delUser(code){
  if(!confirm("Kustuta kasutaja "+code+"?"))return;
  const users = JSON.parse(localStorage.getItem("users")||"{}");
  delete users[code];
  localStorage.setItem("users",JSON.stringify(users));
  showAdmin();
}

// Logout
function logout(){
  localStorage.removeItem("logged");
  showPage("loginPage");
}
</script>
</body>
                                                      </html>
                                                           
